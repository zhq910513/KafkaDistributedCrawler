# 架构组件
    Zookeeper 集群
    Kafka 集群
    Redis 集群
    Scrapy

# 预设场景
    6 台服务器
        1、2、3 作为集群服务器
        4、5、6 作为子节点
        1 作为主节点,负责监控

# 主节点架构
    集群监控:
        consul：
            用于注册和发现 zookeeper/kafka/redis 服务,允许在不修改现有节点配置的情况下动态扩展 zookeeper/kafka/redis 集群，同时保持监控和服务发现的功能
            问题描述：帮我写一个新增服务器集群节点时通用的yml文件，consul用于注册和发现 zookeeper/kafka/redis 服务,允许在不修改现有节点配置的情况下动态扩展 zookeeper/kafka/redis 集群，同时保持监控和服务发现的功能
        zookeeper：
            功能：管理 zookeeper 的任务调度和初始化任务
        kafka：
            功能：管理 kafka 的任务调度和初始化任务
        redis：
            功能：负责 Topic 链接去重和存储请求队列

    指标监控:
        prometheus：
            功能：收集和存储系统的各种指标数据。主节点负责设置 prometheus 来进行系统监控。

        grafana：
            功能：将 prometheus 收集的数据可视化。主节点设置 grafana 以便于查看和分析数据。

        alert_manager(异常警报处理):
            功能：处理系统/数据异常时，告警通知

        alert_resolver(反爬异常处理):
            功能：处理爬虫被反爬的异常情况

    子节点增加：
        功能：主节点可以动态增加子节点

    任务生命周期管理:
        功能：子节点容器启动/销毁

    日志管理:
        功能：
            记录系统运行日志和所有节点运行日志
            记录子节点爬虫执行日志，确保任务执行的可追溯性和问题排查

    爬虫负载均衡：# TODO 



# 子节点功能
    Consul 服务注册：
        功能：
            Kafka 服务
            Redis 服务
            Consul 健康检查

    Prometheus 埋点：
        指标数据埋点到 Prometheus

    Grafana 埋点：
        状态数据埋点到 Grafana

    爬虫功能实现：
        中间件调度：
            动态调用功能中间件

        动态配置调整：
            并发数
            下载延迟

        功能中间件：
            加解密中间件
            Cookie中间件
            自动化中间件


# 系统优化
    Zookeeper 和 Kafka 配置：
        确保 Zookeeper 和 Kafka 的配置能够支持动态扩展，例如在 Zookeeper 集群中适当设置服务器列表。
        Kafka 的分区和副本策略应考虑到集群的负载均衡。
    
    Scrapy 节点配置：
        确保爬虫节点之间的负载均衡和协调，以避免数据抓取的重复或遗漏。
        使用分布式爬虫框架或工具（如 Scrapy Cluster）来增强任务分配和结果整合。
    
    监控和警报：
        在监控和警报系统中设置合理的阈值和规则，以便及时发现并处理潜在问题。
        使用 Prometheus 监控 Zookeeper、Kafka、Redis 和 Scrapy 节点的关键指标，并用 Grafana 进行可视化分析。
    
    备份和恢复：
        确保 Zookeeper 和 Kafka 的数据备份和恢复机制到位，以防数据丢失或系统故障。
        定期备份 Redis 数据，并考虑高可用配置（如 Redis Sentinel）以增强可靠性。

